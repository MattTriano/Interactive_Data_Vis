<!DOCTYPE html>
<html lang="en">
    
    <head>
    
        <meta charset="UTF-8"/>
        
        <link rel="stylesheet" href="lab2.css">
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <!-- <script type="text/javascript" src="../d3.js"></script> -->
        <title>Now Let's Try D3</title>

    </head>

    <body>

        <script type="text/javascript">
          // Data was taken from

            var w       = 600;
            var h       = 400;
            var padding = 50;
            var barPad  = 2;

            var dataset, xScale, yScale, xAxis, yAxis; 

            var parseTime = d3.timeParse("%m/%d/%Y");

            var formatTime = d3.timeFormat("%m %Y");


            var rowConverter = function(d) {
                    return {
                            country:    d.country,
                            co2:        parseFloat(d.co2_tons),
                            gdp:        parseFloat(f.gdp)
                    };
            }

            d3.csv("co2_production_vs_gdp_1980.csv", rowConverter, function(error, data) {
                if (error) {
                    console.log(error);
                } else {
                    dataset = data;

                    var firstQtr = d3.min(dataset, function(d) { return d.Date; });
                    var lastQtr  = d3.max(dataset, function(d) { return d.Date; });

                    xScale = d3.scaleLinear()
                               .domain([0, d3.max(dataset, function(d) { return d.gdp; })])
                               .range([padding, w - padding]);

                    yScale = d3.scaleLinear()
                               .domain([ 0, d3.max(dataset, function(d) { return d.co2; })])
                               .range([h - padding, padding]);

                    aScale = d3.scaleSqrt()
                               .domain([0, d3.max(dataset, function(d) { return d.co2; })])
                               .range([1,5]);

                    var xAxis = d3.axisBottom()
                                  .scale(xScale);
                                  // .tickFormat(formatTime);

                    var yAxis = d3.axisLeft()
                                  .scale(yScale);

                    var svg = d3.select("body")
                                .append("svg")
                                .attr("width", w)
                                .attr("height", h);

                    svg.selectAll("circle")
                       .data(dataset)
                       .enter()
                       .append("circle")
                       .attr("cx", function(d) {
                                      return xScale(d.gdp) - 0.31* padding; 
                       })
                       .attr("cy", function(d) { 
                                      return yScale(d.co2); 
                       })
                       .attr("r", function(d) {
                                      return aScale(d.co2); 
                       })
                       .attr("width", 1);

                    svg.append("g")
                       .attr("class", "axis")
                       .attr("transform", "translate(0," + (h - padding) + ")")
                       .call(xAxis)
                       .selectAll("text")
                          .style("text-anchor", "end")
                          .attr("dx", "-.8em")
                          .attr("dy", ".15em")
                          .attr("transform", "rotate(-65)");

                    svg.append("g")
                       .attr("class", "axis")
                       .attr("transform", "translate(" + padding + ",0)")
                       .call(yAxis);

                    svg.append("text")
                        .attr("x", w/2)
                        .attr("y", padding/2)
                        .attr("text-anchor", "middle")
                        .style("text-decoration", "underline")
                        .text("CO2 output by GDP (1980)")
              }
          });

        // python -m http.server 8888 &.

            

        </script>

    </body>

</html>